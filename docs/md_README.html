<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Alphabot: C++ Alphabot API for the Raspberry PI</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Alphabot
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">C++ Alphabot API for the Raspberry PI </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This page provides instructions how to customise the alphabot so that it's actually usable for research and it provides a C++ API with proper setters and callbacks.</p>
<p ><img src="robot.jpg" alt="alt tag" class="inline"/></p>
<p >C++ class to control the basic functionality of a customised Alphabot (<a href="https://www.waveshare.com/wiki/AlphaBot">https://www.waveshare.com/wiki/AlphaBot</a>) with a Raspberry PI:</p>
<ul>
<li>Motor control (using the Parallax Continuous Rotation Servo)</li>
<li>Battery voltage</li>
</ul>
<h1><a class="anchor" id="autotoc_md1"></a>
Hardware mods</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Parallax Continuous Rotation Servos</h2>
<p >Throw the original DC motors in the bin and fit the <a href="https://www.parallax.com/product/parallax-continuous-rotation-servo/">Parallax Continuous Rotation Servo</a> with 90deg brackets. Plug them into the servo ports S1 and S2.</p>
<p >Wire up the pin header:</p>
<p ><img src="header.jpg" alt="alt tag" class="inline"/></p>
<div class="fragment"><div class="line">GPIO18 / PWM2 = S1 = Motor left</div>
<div class="line">GPIO19 / PWM3 = S2 = Motor right</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3"></a>
Voltage regulator</h2>
<p >De-solder the LM2596 and throw it in the bin. It supposed to have a dropout voltage of 1V so that the 7-7.2V from the battery should be fine but it seems to be more 2V. It's not even recommended by TI who recommend the LMR33630 for new designs.</p>
<p >Replace the LM2596 with a <a href="https://onecall.farnell.com/cosel/mgs100505/dc-dc-converter-5v-2a/dp/4296076">MGS100505</a>. Just glue it upside down on the PCB and run 4 wires to Vin and +5V.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Software prerequisites</h1>
<p >Add to <code>/boot/firmware/config.txt</code>:</p>
<div class="fragment"><div class="line">dtoverlay=pwm-2chan</div>
</div><!-- fragment --><p >and reboot.</p>
<p >Check with:</p>
<div class="fragment"><div class="line">pinctrl -p</div>
</div><!-- fragment --><p >that you see:</p>
<div class="fragment"><div class="line">12: a3    pd | lo // GPIO18 = PWM0_CHAN2</div>
<div class="line">35: a3    pd | lo // GPIO19 = PWM0_CHAN3</div>
</div><!-- fragment --><p >which corresponds to the sysfs files:</p>
<div class="fragment"><div class="line">/sys/class/pwm/pwmchip0/pwm2: GPIO18 </div>
<div class="line">/sys/class/pwm/pwmchip0/pwm3: GPIO19</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
libgpiod</h2>
<p >The GPIO pins are accessed via the C++ API of the <code>libgpiod</code>:</p>
<div class="fragment"><div class="line">apt-get install libgpiod-dev</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
ncurses</h2>
<p >The demo programs below display the sensor readings with the ncurses library. Install it with </p><div class="fragment"><div class="line">apt-get install libncurses-dev</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md7"></a>
Building</h1>
<p >The built system is <code>cmake</code>. Just type: </p><div class="fragment"><div class="line">cmake .</div>
<div class="line">make</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md8"></a>
Usage</h1>
<p >The online documentation is here: <a href="https://berndporr.github.io/alphabot/">https://berndporr.github.io/alphabot/</a></p>
<h2><a class="anchor" id="autotoc_md9"></a>
Start/stop</h2>
<p >Start the callback reporting the battery voltage. </p><div class="fragment"><div class="line">start()</div>
</div><!-- fragment --><p >Stop the callback. </p><div class="fragment"><div class="line">stop()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md10"></a>
Motor speed</h2>
<p >Setting the speeds of the left/right wheels: </p><div class="fragment"><div class="line">setLeftWheelSpeed(float speed);</div>
<div class="line">setRightWheelSpeed(float speed);</div>
</div><!-- fragment --><p> where speed is between -1 and +1.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Callback</h2>
<p >There is callback which reports the battery voltage.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Demo programs</h1>
<p ><img src="testIO.png" alt="alt tag" class="inline"/></p>
<p ><code>testIO</code> is a simple test program which displays the different senor readings and you can test the motors. It also shows how the callback is used to display the sensor readings.</p>
<p ><code>testMotor</code> ramps up the motor speed and back again.</p>
<p ><code>obstacleAvoid.cpp</code> implements a Braitenberg vehicle and it has an emergency stop if the digital readings from the collision sensors are triggered. This is an instructional example and needs to be tweaked. The fun begins here! :) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Aug 8 2025 12:14:40 for Alphabot by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
